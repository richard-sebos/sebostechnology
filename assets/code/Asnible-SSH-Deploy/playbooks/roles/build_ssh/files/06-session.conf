# ==============================================================================
# 06-session.conf — Session keepalives, timeouts & throttling
#
# Purpose:
#   Keep idle sessions in check, prefer SSH-level keepalives over TCP keepalives,
#   limit unauthenticated bursts, and rekey periodically.
#
# Notes:
#   - If another drop-in (e.g., 30-High-Vol.conf) also sets MaxStartups, the
#     *last* one loaded wins. Keep it in one place to avoid confusion.
#   - IMPORTANT: LoginGraceTime=0 means **no authentication timeout**. Use a
#     small non-zero (e.g., 20–60s) if you want a strict cutoff.
# ==============================================================================

# Server probes client idleness every 300s; disconnect after 2 missed replies (~10m)
ClientAliveInterval 300
ClientAliveCountMax 2

# Prefer SSH keepalives; avoid kernel TCP keepalives (less control, more noise)
TCPKeepAlive no

# Authentication grace period:
# 0 = no limit (NOT strict). Consider 20–60s once fully patched if you want a cutoff.
LoginGraceTime 0

# Throttle unauthenticated connection bursts (anti-bruteforce/backoff)
# Format: start:rate:full  (start early-drop at N, drop=rate% at 'full', hard cap at 'full')
MaxStartups 3:30:10

# Rekey to limit data per key / session duration (defense in depth)
RekeyLimit 256M 1h
